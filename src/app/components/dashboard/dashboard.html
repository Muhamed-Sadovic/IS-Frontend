<div class="container py-5" *ngIf="data && data.uloga?.toLowerCase() === 'admin'">
  <div class="row mb-4 align-items-center">
    <div class="col-md-5">
      <h2 class="fw-bold mb-0 text-dark">Admin Panel</h2>
      <p class="text-muted small">Upravljanje sistemom, korisnicima i zalihama</p>
    </div>
    <div class="col-md-7 text-md-end mt-3 mt-md-0">
      <div class="btn-group shadow-sm rounded-pill overflow-hidden border bg-white p-1">
        <button
          class="btn px-3"
          [ngClass]="adminTab === 'stats' ? 'btn-primary' : 'btn-light'"
          (click)="adminTab = 'stats'"
        >
          <i class="bi bi-graph-up me-1"></i> Statistika
        </button>
        <button
          class="btn px-3"
          [ngClass]="adminTab === 'users' ? 'btn-primary' : 'btn-light'"
          (click)="loadUsers()"
        >
          <i class="bi bi-people me-1"></i> Korisnici
        </button>
        <button
          class="btn px-3"
          [ngClass]="adminTab === 'appointments' ? 'btn-primary' : 'btn-light'"
          (click)="adminTab = 'appointments'"
        >
          <i class="bi bi-calendar-event me-1"></i> Termini
        </button>
        <button
          class="btn px-3"
          [ngClass]="adminTab === 'inventar' ? 'btn-primary' : 'btn-light'"
          (click)="loadInventar()"
        >
          <i class="bi bi-box-seam me-1"></i> Inventar
        </button>
      </div>
      <button class="btn btn-success rounded-pill ms-2 shadow-sm" (click)="openDocModal()">
        <i class="bi bi-plus-lg"></i> <span class="d-none d-sm-inline">Novi Stomatolog</span>
      </button>
    </div>
  </div>

  <hr class="mb-5 opacity-10" />

  <div *ngIf="adminTab === 'stats'" class="animate__animated animate__fadeIn">
    <div class="row g-4 mb-5">
      <div class="col-md-6 col-lg-4">
        <div class="card border-0 shadow-sm rounded-4 p-4 bg-primary text-white h-100">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="text-white-50 text-uppercase small">Ukupno Korisnika</h6>
              <h2 class="fw-bold mb-0">{{ data.ukupnoPacijenata }}</h2>
            </div>
            <i class="bi bi-people fs-1 opacity-50"></i>
          </div>
        </div>
      </div>
      <div class="col-md-6 col-lg-4">
        <div class="card border-0 shadow-sm rounded-4 p-4 bg-success text-white h-100">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="text-white-50 text-uppercase small">Svi Termini</h6>
              <h2 class="fw-bold mb-0">{{ data.ukupnoTermina }}</h2>
            </div>
            <i class="bi bi-calendar-check fs-1 opacity-50"></i>
          </div>
        </div>
      </div>
    </div>

    <div class="card border-0 shadow-sm rounded-4 overflow-hidden">
      <div class="card-header bg-white py-3 border-0">
        <h5 class="fw-bold mb-0 text-dark">
          <i class="bi bi-box-seam me-2 text-primary"></i>Kritični Inventar
        </h5>
      </div>
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="bg-light">
            <tr>
              <th class="ps-4">Naziv</th>
              <th class="text-center">Količina</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <ng-container *ngFor="let item of data.inventar">
              <tr *ngIf="item.kolicina < 20">
                <td class="ps-4 fw-semibold">{{ item.naziv }}</td>

                <td class="text-center fw-bold text-danger">{{ item.kolicina }}</td>

                <td>
                  <span class="badge bg-danger rounded-pill px-3">Potrebna nabavka</span>
                </td>
              </tr>
            </ng-container>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div *ngIf="adminTab === 'users'" class="animate__animated animate__fadeIn">
    <div class="row mb-4 g-3 align-items-center">
      <div class="col-md-5 col-lg-4">
        <div class="input-group shadow-sm rounded-pill overflow-hidden border bg-white">
          <span class="input-group-text bg-white border-0 ps-3">
            <i class="bi bi-search text-primary"></i>
          </span>
          <input
            type="text"
            class="form-control border-0 ps-2 py-2"
            placeholder="Pronađi korisnika..."
            [(ngModel)]="searchTerm"
            (input)="currentPage = 1"
            style="box-shadow: none"
          />
        </div>
      </div>

      <div class="col-md-3 col-lg-2">
        <select
          class="form-select shadow-sm rounded-pill border py-2 px-3"
          [(ngModel)]="roleFilter"
          (change)="currentPage = 1"
          style="box-shadow: none; cursor: pointer"
        >
          <option value="Sve">Sve uloge</option>
          <option value="Pacijent">Pacijenti</option>
          <option value="Stomatolog">Stomatolozi</option>
          <option value="Admin">Administratori</option>
        </select>
      </div>

      <div class="col-md-4 col-lg-6 text-md-end">
        <span class="badge bg-light text-dark border rounded-pill px-3 py-2">
          Ukupno: <strong>{{ filteredUsers.length }}</strong> korisnika
        </span>
      </div>
    </div>

    <div class="card border-0 shadow-sm rounded-4 overflow-hidden">
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="bg-light text-uppercase small fw-bold text-muted">
            <tr>
              <th class="ps-4">Ime i Prezime</th>
              <th>Email</th>
              <th>Uloga</th>
              <th class="text-end pe-4">Akcije</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let u of paginatedUsers">
              <td class="ps-4">
                <div class="d-flex align-items-center">
                  <div class="avatar-circle me-3" [ngClass]="getRoleClass(u.uloga)">
                    {{ u.ime[0] }}{{ u.prezime[0] }}
                  </div>
                  <div>
                    <div class="fw-bold text-dark">{{ u.ime }} {{ u.prezime }}</div>
                    <div class="text-muted x-small">ID: #{{ u.id }}</div>
                  </div>
                </div>
              </td>
              <td class="small text-muted">{{ u.email }}</td>
              <td>
                <span class="badge rounded-pill" [ngClass]="getRoleClass(u.uloga)">
                  {{ u.uloga }}
                </span>
              </td>
              <td class="text-end pe-4">
                <button class="btn btn-sm btn-delete" (click)="deleteUser(u.id)">
                  <i class="bi bi-trash3"></i>
                </button>
              </td>
            </tr>

            <tr *ngIf="filteredUsers.length === 0">
              <td colspan="4" class="text-center py-5 text-muted">Nema pronađenih korisnika.</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="card-footer bg-white border-0 py-3" *ngIf="filteredUsers.length > itemsPerPage">
        <nav aria-label="Page navigation">
          <ul class="pagination justify-content-center mb-0">
            <li class="page-item" [class.disabled]="currentPage === 1">
              <button
                class="page-link border-0 rounded-circle mx-1"
                (click)="changePage(currentPage - 1)"
              >
                <i class="bi bi-chevron-left"></i>
              </button>
            </li>

            <li class="page-item" *ngFor="let p of pagesArray">
              <button
                class="page-link border-0 rounded-circle mx-1 fw-bold"
                [class.active-page]="currentPage === p"
                (click)="changePage(p)"
              >
                {{ p }}
              </button>
            </li>

            <li class="page-item" [class.disabled]="currentPage === totalPages">
              <button
                class="page-link border-0 rounded-circle mx-1"
                (click)="changePage(currentPage + 1)"
              >
                <i class="bi bi-chevron-right"></i>
              </button>
            </li>
          </ul>
        </nav>
      </div>
    </div>
  </div>

  <div *ngIf="adminTab === 'appointments'" class="animate__animated animate__fadeIn">
    <div class="row mb-4 align-items-center">
      <div class="col-md-5 col-lg-4">
        <div class="input-group shadow-sm rounded-pill overflow-hidden border bg-white">
          <span class="input-group-text bg-white border-0 ps-3">
            <i class="bi bi-filter text-success"></i>
          </span>
          <input
            type="text"
            class="form-control border-0 ps-2 py-2"
            placeholder="Pretraži termine..."
            [(ngModel)]="appointmentSearch"
            (input)="appointmentsPage = 1"
            style="box-shadow: none"
          />
        </div>
      </div>

      <div class="col-md-7 col-lg-8 text-md-end">
        <span class="badge bg-light text-dark border rounded-pill px-3 py-2">
          Ukupno: <strong>{{ filteredAppointments.length }}</strong> termina
        </span>
      </div>
    </div>

    <div class="card border-0 shadow-sm rounded-4 overflow-hidden">
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="bg-light text-uppercase small fw-bold text-muted">
            <tr>
              <th class="ps-4">Datum i Vreme</th>
              <th>Pacijent</th>
              <th>Stomatolog</th>
              <th>Status</th>
              <th class="text-end pe-4">Akcija</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let t of paginatedAppointments">
              <td class="ps-4">
                <div class="fw-bold text-dark">{{ t.datumVreme | date: 'dd.MM.yyyy' }}</div>
                <div class="text-primary small fw-semibold">
                  {{ t.datumVreme | date: 'HH:mm' }}h
                </div>
              </td>
              <td>{{ t.pacijentIme }}</td>
              <td>Dr. {{ t.stomatologIme }}</td>
              <td>
                <span
                  class="badge rounded-pill"
                  [ngClass]="{
                    'bg-warning-subtle text-warning': t.status === 'NaCekanju',
                    'bg-success-subtle text-success': t.status === 'Prihvacen',
                    'bg-danger-subtle text-danger': t.status === 'Odbijen',
                    'bg-secondary-subtle text-secondary': t.status === 'Zavrsen',
                  }"
                >
                  {{ t.status }}
                </span>
              </td>
              <td class="text-end pe-4">
                <div class="btn-group me-2" *ngIf="t.status === 'NaCekanju'">
                  <button
                    class="btn btn-sm btn-outline-success border-0"
                    (click)="odgovoriNaTermin(t.id, 'Prihvacen')"
                    title="Odobri"
                  >
                    <i class="bi bi-check-circle-fill"></i>
                  </button>
                  <button
                    class="btn btn-sm btn-outline-danger border-0"
                    (click)="odgovoriNaTermin(t.id, 'Odbijen')"
                    title="Odbij"
                  >
                    <i class="bi bi-x-circle-fill"></i>
                  </button>
                </div>

                <button
                  class="btn btn-sm btn-outline-secondary border-0"
                  (click)="deleteAppointment(t.id)"
                >
                  <i class="bi bi-trash3"></i>
                </button>
              </td>
            </tr>

            <tr *ngIf="filteredAppointments.length === 0">
              <td colspan="5" class="text-center py-5 text-muted">
                Nema zakazanih termina za prikazivanje.
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div
        class="card-footer bg-white border-0 py-3"
        *ngIf="filteredAppointments.length > appointmentsPerPage"
      >
        <nav aria-label="Page navigation">
          <ul class="pagination justify-content-center mb-0">
            <li class="page-item" [class.disabled]="appointmentsPage === 1">
              <button
                class="page-link border-0 rounded-circle mx-1"
                (click)="changeAppPage(appointmentsPage - 1)"
              >
                <i class="bi bi-chevron-left"></i>
              </button>
            </li>

            <li class="page-item" *ngFor="let p of appPagesArray">
              <button
                class="page-link border-0 rounded-circle mx-1 fw-bold"
                [class.active-page]="appointmentsPage === p"
                (click)="changeAppPage(p)"
              >
                {{ p }}
              </button>
            </li>

            <li class="page-item" [class.disabled]="appointmentsPage === totalAppPages">
              <button
                class="page-link border-0 rounded-circle mx-1"
                (click)="changeAppPage(appointmentsPage + 1)"
              >
                <i class="bi bi-chevron-right"></i>
              </button>
            </li>
          </ul>
        </nav>
      </div>
    </div>
  </div>
  <div *ngIf="adminTab === 'inventar'" class="animate__animated animate__fadeIn">
    <div class="row g-4">
      <div class="col-lg-4">
        <div class="card border-0 shadow-sm rounded-4 p-4 bg-light">
          <h5 class="fw-bold mb-3">Novi Materijal</h5>
          <div class="mb-3">
            <label class="form-label small fw-bold">Naziv</label>
            <input
              type="text"
              class="form-control rounded-pill"
              [(ngModel)]="noviMaterijal.naziv"
            />
          </div>
          <div class="mb-3">
            <label class="form-label small fw-bold">Količina</label>
            <input
              type="number"
              class="form-control rounded-pill"
              [(ngModel)]="noviMaterijal.kolicina"
            />
          </div>
          <div class="mb-3">
            <label class="form-label small fw-bold">Opis</label>
            <textarea
              class="form-control rounded-4"
              [(ngModel)]="noviMaterijal.opis"
              rows="2"
            ></textarea>
          </div>
          <button class="btn btn-primary w-100 rounded-pill fw-bold" (click)="saveNoviMaterijal()">
            <i class="bi bi-save me-2"></i>Dodaj u inventar
          </button>
        </div>
      </div>

      <div class="col-lg-8">
        <div class="card border-0 shadow-sm rounded-4 overflow-hidden">
          <div class="table-responsive">
            <div class="card border-0 shadow-sm rounded-4 overflow-hidden">
              <div
                class="table-responsive table-scroll"
                style="max-height: 407px; overflow-y: auto"
              >
                <table class="table table-hover align-middle mb-0">
                  <thead class="bg-light text-uppercase small fw-bold text-muted text-center">
                    <tr>
                      <th class="text-start ps-4">Materijal</th>
                      <th>Količina</th>
                      <th>Status</th>
                      <th class="text-end pe-4">Korekcija</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let item of inventar">
                      <td class="ps-4">
                        <div class="fw-bold text-dark">{{ item.naziv }}</div>
                        <div class="x-small text-muted">{{ item.opis || 'Nema opisa' }}</div>
                      </td>
                      <td class="text-center fw-bold fs-5">{{ item.kolicina }}</td>
                      <td class="text-center">
                        <span
                          *ngIf="item.kolicina < 10"
                          class="badge bg-danger-subtle text-danger rounded-pill px-3"
                        >
                          Kritično
                        </span>

                        <span
                          *ngIf="item.kolicina >= 10 && item.kolicina <= 20"
                          class="badge bg-warning-subtle text-warning-emphasis rounded-pill px-3"
                        >
                          Pri kraju
                        </span>

                        <span
                          *ngIf="item.kolicina > 20"
                          class="badge bg-success-subtle text-success rounded-pill px-3"
                        >
                          U redu
                        </span>
                      </td>
                      <td class="text-end pe-4">
                        <div class="btn-group btn-group-sm rounded-pill overflow-hidden border">
                          <button class="btn btn-light" (click)="updateKolicina(item.id, -1)">
                            -1
                          </button>
                          <button class="btn btn-light" (click)="updateKolicina(item.id, 1)">
                            +1
                          </button>
                          <button
                            class="btn btn-light bg-white"
                            (click)="updateKolicina(item.id, 10)"
                          >
                            +10
                          </button>
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="container py-5" *ngIf="data?.uloga === 'Stomatolog'">
  <div class="row mb-4">
    <div class="col-md-12">
      <h2 class="fw-bold mb-0 text-dark">Portal za Stomatologe</h2>
      <p class="text-muted small">Pregled zakazanih termina i unos medicinskih nalaza</p>
    </div>
  </div>

  <div class="card border-0 shadow-sm rounded-4 overflow-hidden">
    <div class="card-header bg-white py-3 border-0">
      <h5 class="fw-bold mb-0 text-dark">
        <i class="bi bi-person-badge me-2 text-primary"></i>Današnji pacijenti
      </h5>
    </div>
    <div class="table-responsive">
      <table class="table table-hover align-middle mb-0">
        <thead class="bg-light text-uppercase small fw-bold text-muted">
          <tr>
            <th class="ps-4">Vreme</th>
            <th>Pacijent</th>
            <th>Tretman</th>
            <th>Status</th>
            <th class="text-end pe-4">Akcija</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let t of doctorAppointments" class="animate__animated animate__fadeIn">
            <td class="ps-4">
              <div class="fw-bold text-dark">{{ t.datumVreme | date: 'HH:mm' }}h</div>
              <div class="text-primary small fw-semibold">
                {{ t.datumVreme | date: 'dd.MM.yyyy' }}
              </div>
            </td>
            <td>
              <div class="fw-bold">{{ t.pacijentIme }}</div>
              <div class="text-muted extra-small">ID termina: #{{ t.id }}</div>
            </td>
            <td>
              <span class="badge bg-info-subtle text-info fw-bold">
                {{ t.tretman || 'Nije navedeno' }}
              </span>
            </td>
            <td>
              <span class="badge rounded-pill bg-success-subtle text-success">
                {{ t.status }}
              </span>
            </td>
            <td class="text-end pe-4">
              <button
                class="btn btn-primary btn-sm rounded-pill px-3 shadow-sm"
                (click)="openPregledModal(t)"
              >
                <i class="bi bi-clipboard-pulse me-1"></i> Obavi pregled
              </button>
            </td>
          </tr>

          <tr *ngIf="doctorAppointments.length === 0">
            <td colspan="5" class="text-center py-5 text-muted">
              <i class="bi bi-calendar-check d-block fs-1 mb-2 opacity-50"></i>
              Trenutno nemate zakazanih pacijenata za prikaz.
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<div class="modal fade" id="docModal" #docModal tabindex="-1" aria-labelledby="docModalLabel">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow rounded-4">
      <div class="modal-header bg-success text-white rounded-top-4">
        <h5 class="modal-title fw-bold">
          <i class="bi bi-person-plus-fill me-2"></i>Novi Stomatolog
        </h5>
        <button
          type="button"
          class="btn-close btn-close-white"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body p-4">
        <form #docForm="ngForm">
          <div class="mb-3">
            <label class="form-label small fw-bold">Ime</label>
            <input
              type="text"
              class="form-control rounded-pill"
              name="ime"
              [(ngModel)]="noviDoc.ime"
              required
            />
          </div>
          <div class="mb-3">
            <label class="form-label small fw-bold">Prezime</label>
            <input
              type="text"
              class="form-control rounded-pill"
              name="prezime"
              [(ngModel)]="noviDoc.prezime"
              required
            />
          </div>
          <div class="mb-3">
            <label class="form-label small fw-bold">Email adresa</label>
            <input
              type="email"
              class="form-control rounded-pill"
              name="email"
              [(ngModel)]="noviDoc.email"
              required
            />
          </div>
          <div class="mb-3">
            <label class="form-label small fw-bold">Lozinka</label>
            <input
              type="password"
              class="form-control rounded-pill"
              name="lozinka"
              [(ngModel)]="noviDoc.lozinka"
              required
            />
          </div>
          <button
            type="button"
            class="btn btn-success w-100 rounded-pill fw-bold py-2"
            (click)="saveStomatolog()"
          >
            Sačuvaj Stomatologa
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="container py-5" *ngIf="data?.uloga === 'Pacijent'">
  <div class="row g-4">
    <div class="col-lg-4">
      <div class="card border-0 shadow-sm rounded-4 h-100 booking-card">
        <div class="card-header bg-white border-0 pt-4 px-4">
          <div class="d-flex align-items-center mb-2">
            <div class="icon-box bg-primary-subtle text-primary rounded-circle me-3">
              <i class="bi bi-calendar-plus fs-5"></i>
            </div>
            <h5 class="fw-bold mb-0 text-dark">Novo zakazivanje</h5>
          </div>
          <p class="text-muted small ms-5 mb-0">Popunite formu za novi termin.</p>
        </div>

        <div class="card-body p-4">
          <div class="mb-3">
            <label class="form-label small fw-bold text-muted text-uppercase">Stomatolog</label>
            <div class="input-group">
              <span class="input-group-text bg-light border-end-0"
                ><i class="bi bi-person-medical text-primary"></i
              ></span>

              <select
                class="form-select bg-light border-start-0 ps-2 fw-semibold"
                [(ngModel)]="noviTermin.stomatologId"
                (change)="ucitajSlobodneTermine()"
              >
                <option [ngValue]="null" disabled>Izaberite doktora...</option>
                <option *ngFor="let s of stomatolozi" [value]="s.id">
                  Dr {{ s.ime }} {{ s.prezime }}
                </option>
              </select>
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label small fw-bold text-muted text-uppercase">Usluga</label>
            <div class="input-group">
              <span class="input-group-text bg-light border-end-0"
                ><i class="bi bi-tools text-primary"></i
              ></span>

              <select
                class="form-select bg-light border-start-0 ps-2 fw-semibold"
                [(ngModel)]="noviTermin.uslugaId"
                (change)="ucitajSlobodneTermine()"
              >
                <option [ngValue]="null" disabled>Izaberite tretman...</option>
                <option *ngFor="let u of listaUsluga" [value]="u.id">
                  {{ u.naziv }} ({{ u.cena }} RSD)
                </option>
              </select>
            </div>
          </div>

          <div class="mb-4">
            <label class="form-label small fw-bold text-muted text-uppercase">Datum</label>
            <div class="input-group">
              <span class="input-group-text bg-light border-end-0"
                ><i class="bi bi-calendar3 text-primary"></i
              ></span>
              <input
                type="date"
                class="form-control bg-light border-start-0 ps-0 fw-semibold"
                [(ngModel)]="izabranDatum"
                [min]="minDatum.split('T')[0]"
                [max]="maxDatum.split('T')[0]"
              />
            </div>
          </div>

          <div class="mb-4">
            <label class="form-label small fw-bold text-muted text-uppercase d-block mb-2">
              Slobodni termini <span class="fw-normal text-muted lowercase">(09:00 - 17:00)</span>
            </label>

            <div class="time-grid" *ngIf="slobodniTermini.length > 0; else nemaTermina">
              <div *ngFor="let t of slobodniTermini">
                <input
                  type="radio"
                  class="btn-check"
                  name="vreme"
                  [id]="'time-' + t"
                  [value]="t"
                  [(ngModel)]="izabranoVreme"
                />
                <label class="time-slot-label w-100" [for]="'time-' + t">
                  {{ t }}
                </label>
              </div>
            </div>

            <ng-template #nemaTermina>
              <div class="text-center p-3 bg-light rounded-3 text-muted small">
                <i class="bi bi-calendar-x me-1"></i> Nema slobodnih termina za ovaj datum.
              </div>
            </ng-template>
          </div>

          <button
            class="btn btn-primary w-100 py-2 rounded-3 fw-bold shadow-sm mt-2"
            (click)="zakazi()"
          >
            <i class="bi bi-check2-circle me-1"></i> Potvrdi termin
          </button>
        </div>
      </div>
    </div>

    <div class="col-lg-8">
      <div class="card border-0 shadow-sm rounded-4 h-100 overflow-hidden">
        <div
          class="card-header bg-white border-0 pt-4 px-4 pb-0 d-flex justify-content-between align-items-center"
        >
          <div class="d-flex align-items-center">
            <div class="icon-box bg-success-subtle text-success rounded-circle me-3">
              <i class="bi bi-clock-history fs-5"></i>
            </div>
            <h5 class="fw-bold mb-0 text-dark">Moji Termini</h5>
          </div>
          <span class="badge bg-light text-dark border rounded-pill"
            >{{ myAppointments.length }} ukupno</span
          >
        </div>

        <div class="card-body p-0 mt-3">
          <div class="table-responsive">
            <table class="table table-hover align-middle mb-0 custom-table">
              <thead class="bg-light text-secondary text-uppercase x-small fw-bold">
                <tr>
                  <th class="ps-4 py-3">Datum & Vreme</th>
                  <th class="py-3">Doktor & Usluga</th>
                  <th class="py-3">Status</th>
                  <th class="py-3 text-end pe-4">Akcija</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let t of myAppointments">
                  <td class="ps-4">
                    <div class="d-flex flex-column">
                      <span class="fw-bold text-dark">{{ t.datumVreme | date: 'dd.MM.yyyy' }}</span>
                      <span class="small text-primary fw-bold"
                        ><i class="bi bi-clock me-1"></i>{{ t.datumVreme | date: 'HH:mm' }}h</span
                      >
                    </div>
                  </td>

                  <td>
                    <div class="d-flex flex-column">
                      <span class="fw-semibold text-dark">Dr {{ t.stomatologIme }}</span>
                      <span class="small text-muted">{{ t.tretman }} - {{ t.cena }} RSD</span>
                    </div>
                  </td>

                  <td>
                    <span
                      class="badge rounded-pill border px-3 py-2"
                      [ngClass]="{
                        'bg-warning-subtle text-warning border-warning-subtle':
                          t.status === 'NaCekanju',
                        'bg-success-subtle text-success border-success-subtle':
                          t.status === 'Prihvacen',
                        'bg-danger-subtle text-danger border-danger-subtle': t.status === 'Odbijen',
                        'bg-secondary-subtle text-secondary border-secondary-subtle':
                          t.status === 'Zavrsen',
                      }"
                    >
                      <i
                        class="bi"
                        [ngClass]="{
                          'bi-hourglass-split': t.status === 'NaCekanju',
                          'bi-check-circle-fill': t.status === 'Prihvacen',
                          'bi-x-circle-fill': t.status === 'Odbijen',
                          'bi-flag-fill': t.status === 'Zavrsen',
                        }"
                      ></i>
                      {{ t.status }}
                    </span>
                  </td>

                  <td class="text-end pe-4">
                    <button
                      *ngIf="t.status === 'Zavrsen' && !t.jePlacen && t.imaRacun"
                      class="btn btn-sm btn-primary rounded-pill px-3 shadow-sm me-1"
                      (click)="platiRacun(t.id, t.cena)"
                      [disabled]="isProcessing"
                    >
                      <span *ngIf="!isProcessing"
                        ><i class="bi bi-credit-card me-1"></i> Plati</span
                      >
                      <span *ngIf="isProcessing" class="spinner-border spinner-border-sm"></span>
                    </button>

                    <span *ngIf="t.jePlacen" class="badge bg-success rounded-pill px-3 py-2">
                      <i class="bi bi-check-all me-1"></i> Plaćeno
                    </span>

                    <button
                      *ngIf="t.status === 'NaCekanju'"
                      class="btn btn-sm btn-outline-danger border-0 rounded-circle p-2 hover-bg-danger"
                      (click)="otkaziMojTermin(t.id)"
                      title="Otkaži termin"
                    >
                      <i class="bi bi-trash"></i>
                    </button>
                  </td>
                </tr>

                <tr *ngIf="myAppointments.length === 0">
                  <td colspan="4" class="text-center py-5">
                    <div class="text-muted opacity-50 mb-2">
                      <i class="bi bi-calendar-x" style="font-size: 2rem"></i>
                    </div>
                    <p class="text-muted small m-0">Trenutno nemate zakazanih termina.</p>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade shadow" id="pregledModal" #pregledModal tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 rounded-4">
      <div class="modal-header border-0 pb-0">
        <h5 class="modal-title fw-bold">Unos rezultata pregleda</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="p-3 bg-light rounded-3 mb-4">
          <div class="small text-muted text-uppercase fw-bold">Pacijent:</div>
          <div class="fs-5 fw-bold text-primary">{{ selectedTermin?.pacijentIme }}</div>
        </div>

        <div class="mb-3">
          <label class="form-label small fw-bold text-muted text-uppercase">Dijagnoza</label>
          <textarea
            class="form-control border-2 rounded-3"
            rows="3"
            [(ngModel)]="pregledData.dijagnoza"
            placeholder="Upišite dijagnozu pacijenta..."
          >
          </textarea>
        </div>

        <div class="mb-3">
          <label class="form-label small fw-bold text-muted text-uppercase">Terapija i Savet</label>
          <textarea
            class="form-control border-2 rounded-3"
            rows="3"
            [(ngModel)]="pregledData.terapija"
            placeholder="Upišite propisanu terapiju ili lekove..."
          >
          </textarea>
        </div>
      </div>

      <hr class="my-4 opacity-10" />

      <div class="bg-light p-3 rounded-4 mb-3">
        <h6 class="fw-bold mb-3 small text-uppercase">
          <i class="bi bi-box-seam me-2"></i>Utrošeni materijal
        </h6>

        <div class="row g-2 align-items-end mb-3">
          <div class="col-7">
            <label class="small text-muted">Materijal</label>
            <select
              class="form-select form-select-sm rounded-pill"
              [(ngModel)]="izabranMaterijalId"
            >
              <option [ngValue]="null">Izaberi...</option>
              <option *ngFor="let item of inventar" [value]="item.id">
                {{ item.naziv }} (Na stanju: {{ item.kolicina }})
              </option>
            </select>
          </div>
          <div class="col-3">
            <label class="small text-muted">Kol.</label>
            <input
              type="number"
              class="form-control form-control-sm rounded-pill"
              [(ngModel)]="kolicinaZaPotrosnju"
              min="1"
            />
          </div>
          <div class="col-2">
            <button class="btn btn-sm btn-primary w-100 rounded-pill" (click)="dodajUPotrosnju()">
              <i class="bi bi-plus-lg"></i>
            </button>
          </div>
        </div>

        <div
          class="list-group list-group-flush rounded-3 overflow-hidden shadow-sm"
          *ngIf="listaPotrosnje.length > 0"
        >
          <div
            class="list-group-item d-flex justify-content-between align-items-center py-2"
            *ngFor="let p of listaPotrosnje; let i = index"
          >
            <div>
              <span class="fw-bold text-dark">{{ p.naziv }}</span>
              <span class="text-muted small ms-2">x {{ p.kolicina }} kom</span>
            </div>
            <button class="btn btn-link text-danger p-0" (click)="obrisiIzPotrosnje(i)">
              <i class="bi bi-x-circle-fill"></i>
            </button>
          </div>
        </div>
        <div *ngIf="listaPotrosnje.length === 0" class="text-center text-muted small py-2">
          Još niste dodali materijal.
        </div>
      </div>
      <div class="modal-footer border-0 pt-0">
        <button type="button" class="btn btn-light rounded-pill px-4" data-bs-dismiss="modal">
          Odustani
        </button>
        <button
          type="button"
          class="btn btn-success rounded-pill px-4 shadow-sm"
          (click)="savePregled()"
        >
          <i class="bi bi-check-lg me-1"></i> Završi i sačuvaj
        </button>
      </div>
    </div>
  </div>
</div>
